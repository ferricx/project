var songData,currentSortField,ascending=false,greatestId=0,originalSongData;$(function(){$(".datepicker").datepicker()});function testSongItem(a){QUnit.test("Song Item Test",function(b){b.ok(a.Id.length>0,"no title  set");b.ok(a.Title.length>0,"no artist set");b.ok(a.Artist.length>0,"no release date set");b.ok(a["Release Date"]>0,"no price set")})}function getSongList(){console.log("getsonglist");$.ajax({type:"GET",url:"http://localhost/project/json/songs.json",dataType:"json",success:function(a){songData=a;buildSongData()},error:function(a){alert("failed to get song data")}})}$(document).ready(function(){var a,c="asc";getSongList();$("#filter-form").submit(function(d){d.preventDefault()});function b(d){return function(g,f){var e=(g[d]<f[d])?-1:(g[d]>f[d])?1:0;return e}}$("body").on("click",".header",function(){if(currentSortField===$(this).text()){ascending=!ascending}else{ascending=true;currentSortField=$(this).text()}if(ascending){songData.reverse(b($(this).text()));songData.sort(b($(this).text()))}else{songData.sort(b($(this).text()));songData.reverse(b($(this).text()))}buildSongData()});$("body").on("click",".utility > a",function(){if($(this).hasClass("utility-edit")){$(".utility > a").hide();$(".utility-save").show();songId=$(this).parent().data("id");buildEditItem(songId)}else{if($(this).hasClass("utility-save")){$(".song-edit").submit()}}})});function saveSong(){var a={};found=false;songId=$(".song-edit").attr("id");a.Id=songId;$.each($(".song-edit").serializeArray(),function(b,c){a[c.name]=c.value});$.each(songData,function(b,c){if(c.Id==songId){found=true;songData[b]=a}});if(!found){songData.push(a)}buildSongData()}function saveList(){$.ajax({url:"http://localhost/project/json/savesongs"+(oneInRandomFails(5)?"fail":"")+".json",type:"POST",data:songData,success:function(a){if(a.success){buildSongData()}else{alert("save failed")}},error:function(a){alert("failed to save song list")}})}function filterResults(){tmpSongData=new Array();startDate=new Date($("#start-date").val());endDate=new Date($("#end-date").val());console.log(Number(endDate));if(!originalSongData){originalSongData=songData}$.each(songData,function(a,b){relDate=new Date(b["Release Date"]);console.log("reldate"+Number(relDate));if((Number(relDate)>Number(startDate))&&(Number(relDate)<Number(endDate))){console.log("matches");tmpSongData.push(b)}});console.log(tmpSongData);songData=tmpSongData;console.log(songData.length);buildSongData()}function clearFilter(){if(originalSongData){songData=originalSongData}buildSongData()}function oneInRandomFails(a){roll=Math.floor((Math.random()*a)+1);return(roll===a)}function buildSongData(){$(".song-list").empty();var a="<div class='song-list-header block-menu-block row'>";rows="";first=true;console.log(songData.length);$.each(songData,function(b,c){testSongItem(c);if(c.Id>greatestId){greatestId=c.Id}rows+="<div class='song-item row' id='"+c.Id+"'>";$.each(c,function(d,e){classname=d.replace(/ /g,"");if(first){a+="<div class='"+classname+" header cell'>"+d+"</div>"}rows+="<div class='"+classname+" cell'>"+e+"</div>"});first=false;rows+="<div class='utility cell'  data-id='"+c.Id+"'><a class='utility-edit' id='edit'>edit </a><a class='utility-delete' id='delete'>delete </a></div></div>"});a+="</div>";output=a+rows;$(".song-list").append(output);$(".btn-submit").prop("disabled",false);QUnit.test("Song List Test",function(b){b.ok($(".song-item").length<=5,"too many songs")})}function buildEditItem(a){$(".btn-submit").prop("disabled",true);if(a){thisSong=$("#"+a);row="";newSong=false}else{newSong=true;thisSong="";greatestId=parseInt(greatestId)+1;a=greatestId;row="<div class='song-item row' id='"+a+"'>"}title=(thisSong!=="")?$(thisSong).children(".Title").text():"";artist=(thisSong!=="")?$(thisSong).children(".Artist").text():"";date=(thisSong!=="")?$(thisSong).children(".ReleaseDate").text():"";price=(thisSong!=="")?$(thisSong).children(".Price").text():"";row+="<form action='javascript:saveSong()' class='song-edit row' id='"+a+"' name='song-edit'><div class='Id cell'>"+a+"</div><input type='text' class='Title cell' name='Title' id='edit-title' value='"+title+"'><input type='text' class='Artist cell' name='Artist' id='edit-artist' value='"+artist+"'><input type='text' class='ReleaseDate datepicker cell' name='Release Date'  id='edit-releaseDate' value='"+date+"'><input type='text' class='Price cell' name='Price' id='edit-title' value='"+price+"'><div class='utility cell' data-id='"+a+"'><a class='utility-save' id='save'>save</a></div></form>";if(newSong){row+="</div>";$(".song-list").append(row);$(".utility > a").hide();$(".utility-save").show()}else{$(thisSong).empty();$(thisSong).append(row)}$(".datepicker").datepicker()};